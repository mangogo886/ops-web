<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - æ¡£æ¡ˆå®¡æ ¸ç®¡ç†</title>
    <script src="/static/echarts/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
            display: flex;
            height: 100vh;
        }

        /* å·¦ä¾§å¯¼èˆªæ  - ä¿æŒåŸé£æ ¼ */
        .sidebar {
            width: 180px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .sidebar h3 {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #34495e;
            margin: 0;
        }

        .menu-item {
            padding: 15px 20px;
            color: #ecf0f1;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #34495e;
        }

        .menu-item:hover {
            background-color: #34495e;
        }

        .menu-item.active {
            background-color: #3498db;
        }

        .submenu-item {
            padding: 12px 20px 12px 40px;
            font-size: 14px;
            color: #bdc3c7;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #34495e;
        }

        .submenu-item:hover {
            background-color: #34495e;
        }

        .submenu-item.active {
            background-color: #2980b9;
            color: white;
        }

        /* å³ä¾§å†…å®¹åŒºåŸŸ - å¤§å±é£æ ¼ */
        .content {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            background: rgba(26, 31, 58, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-bottom: 2px solid rgba(0, 150, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(90deg, #00d4ff 0%, #5b8def 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-btn {
            padding: 10px 20px;
            background: rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 150, 255, 0.5);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: rgba(0, 150, 255, 0.4);
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .nav-btn.logout {
            background: rgba(231, 76, 60, 0.2);
            border-color: rgba(231, 76, 60, 0.5);
            color: #ff6b6b;
        }

        .nav-btn.logout:hover {
            background: rgba(231, 76, 60, 0.4);
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        .time-selector {
            display: flex;
            gap: 10px;
        }

        .time-btn {
            padding: 10px 20px;
            background: rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 150, 255, 0.5);
            color: #00d4ff;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .time-btn:hover {
            background: rgba(0, 150, 255, 0.4);
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .time-btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #5b8def 100%);
            border-color: #00d4ff;
            color: #fff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        /* ä¸»å®¹å™¨ */
        .container {
            padding: 20px 30px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--card-color), transparent);
            opacity: 0.8;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--card-color);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-card.total { --card-color: #00d4ff; }
        .stat-card.pending { --card-color: #ffa726; }
        .stat-card.need-fix { --card-color: #ef5350; }
        .stat-card.completed { --card-color: #66bb6a; }
        .stat-card.pending-sample { --card-color: #ffeb3b; }
        .stat-card.sample-need-fix { --card-color: #ff7043; }
        .stat-card.sample-passed { --card-color: #26c6da; }
        .stat-card.tagged { --card-color: #ab47bc; }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-card-title {
            font-size: 16px;
            color: #b0bec5;
            font-weight: 500;
        }

        .stat-card-icon {
            font-size: 32px;
            opacity: 0.8;
        }

        .stat-card-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--card-color);
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            line-height: 1;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .chart-box {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .chart-title {
            font-size: 20px;
            color: #00d4ff;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: #00d4ff;
            font-size: 18px;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* æ•°æ®æ›´æ–°æç¤º */
        .update-time {
            text-align: center;
            color: #64b5f6;
            font-size: 14px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(100, 181, 246, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .update-time .loading {
            display: inline-block;
            margin-right: 8px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
                overflow-y: auto;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px 20px;
            }

            .header h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .container {
                padding: 15px;
            }
        }

        /* æ•°å­—åŠ¨ç”»æ•ˆæœ */
        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card-value {
            animation: countUp 0.6s ease-out;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <div class="sidebar">
        <h3>æ¡£æ¡ˆå®¡æ ¸ç®¡ç†</h3>
        <a href="/overview" class="menu-item {{if eq .ActiveMenu "overview"}}active{{end}}">æ•°æ®æ¦‚è§ˆ</a>
        <a href="/stats" class="menu-item {{if eq .ActiveMenu "stats"}}active{{end}}">ç»Ÿè®¡ä¿¡æ¯</a>
        <a href="/device/filelist" class="menu-item {{if eq .ActiveMenu "filelist"}}active{{end}}">å»ºæ¡£æ˜ç»†</a>
        <a href="/device/filelist" class="submenu-item {{if eq .SubMenu "device_filelist"}}active{{end}}">è®¾å¤‡å»ºæ¡£æ˜ç»†</a>
        <a href="/checkpoint/filelist" class="submenu-item {{if eq .SubMenu "checkpoint_filelist"}}active{{end}}">å¡å£å»ºæ¡£æ˜ç»†</a>
        <a href="/audit" class="menu-item {{if eq .ActiveMenu "audit"}}active{{end}}">æ¡£æ¡ˆå®¡æ ¸</a>
        <a href="/audit/progress" class="submenu-item {{if eq .SubMenu "audit_progress"}}active{{end}}">è®¾å¤‡å®¡æ ¸è¿›åº¦</a>
        <a href="/audit/progress/video-reminders" class="submenu-item {{if eq .SubMenu "video_reminders"}}active{{end}}">å½•åƒå¤©æ•°ä¸è¶³æé†’</a>
        <a href="/checkpoint/progress" class="submenu-item {{if eq .SubMenu "checkpoint_progress"}}active{{end}}">å¡å£å®¡æ ¸è¿›åº¦</a>
        <a href="/audit/statistics" class="submenu-item {{if eq .SubMenu "audit_statistics"}}active{{end}}">æœˆåº¦å»ºæ¡£æ•°æ®</a>
        <a href="/users" class="menu-item {{if eq .ActiveMenu "settings"}}active{{end}}">ç³»ç»Ÿè®¾ç½®</a>
        <a href="/users" class="submenu-item {{if eq .SubMenu "users"}}active{{end}}">ç”¨æˆ·ä¿¡æ¯</a>
        <a href="/permission" class="submenu-item {{if eq .SubMenu "permission"}}active{{end}}">æƒé™è®¾ç½®</a>
        <a href="/taskconfig" class="submenu-item {{if eq .SubMenu "task_config"}}active{{end}}">ä»»åŠ¡é…ç½®</a>
        <a href="/logs" class="submenu-item {{if eq .SubMenu "logs"}}active{{end}}">æ“ä½œæ—¥å¿—</a>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div class="header">
            <h1>ğŸ“Š æ•°æ®æ¦‚è§ˆ</h1>
            <div class="time-selector">
                <button class="time-btn" data-range="week" onclick="changeTimeRange('week')">è¿‘ä¸€å‘¨</button>
                <button class="time-btn" data-range="month" onclick="changeTimeRange('month')">è¿‘ä¸€æœˆ</button>
                <button class="time-btn" data-range="all" onclick="changeTimeRange('all')">å…¨éƒ¨</button>
            </div>
        </div>

        <!-- ä¸»å®¹å™¨ -->
        <div class="container">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card total">
                <div class="stat-card-header">
                    <div class="stat-card-title">å¯¼å…¥æ¡£æ¡ˆæ€»æ•°</div>
                    <div class="stat-card-icon">ğŸ“Š</div>
                </div>
                <div class="stat-card-value" id="total">0</div>
            </div>
            <div class="stat-card pending">
                <div class="stat-card-header">
                    <div class="stat-card-title">æœªå®¡æ ¸</div>
                    <div class="stat-card-icon">â³</div>
                </div>
                <div class="stat-card-value" id="pending">0</div>
            </div>
            <div class="stat-card need-fix">
                <div class="stat-card-header">
                    <div class="stat-card-title">å·²å®¡æ ¸å¾…æ•´æ”¹</div>
                    <div class="stat-card-icon">âš ï¸</div>
                </div>
                <div class="stat-card-value" id="needFix">0</div>
            </div>
            <div class="stat-card completed">
                <div class="stat-card-header">
                    <div class="stat-card-title">å·²å®Œæˆ</div>
                    <div class="stat-card-icon">âœ…</div>
                </div>
                <div class="stat-card-value" id="completed">0</div>
            </div>
            <div class="stat-card pending-sample">
                <div class="stat-card-header">
                    <div class="stat-card-title">å¾…æŠ½æ£€</div>
                    <div class="stat-card-icon">ğŸ”</div>
                </div>
                <div class="stat-card-value" id="pendingSample">0</div>
            </div>
            <div class="stat-card sample-need-fix">
                <div class="stat-card-header">
                    <div class="stat-card-title">æŠ½æ£€åå¾…æ•´æ”¹</div>
                    <div class="stat-card-icon">ğŸ”„</div>
                </div>
                <div class="stat-card-value" id="sampleNeedFix">0</div>
            </div>
            <div class="stat-card sample-passed">
                <div class="stat-card-header">
                    <div class="stat-card-title">æŠ½æ£€å·²é€šè¿‡</div>
                    <div class="stat-card-icon">ğŸ‰</div>
                </div>
                <div class="stat-card-value" id="samplePassed">0</div>
            </div>
            <div class="stat-card tagged">
                <div class="stat-card-header">
                    <div class="stat-card-title">å·²æ‰“æ ‡ç­¾æ¡£æ¡ˆæ•°é‡</div>
                    <div class="stat-card-icon">ğŸ·ï¸</div>
                </div>
                <div class="stat-card-value" id="taggedCount" style="font-size: 14px; line-height: 1.6; text-align: left; padding: 10px 0;">æš‚æ— æ•°æ®</div>
            </div>
        </div>

        <!-- å›¾è¡¨å®¹å™¨ -->
        <div class="charts-container">
            <div class="chart-box">
                <div class="chart-title">å®¡æ ¸çŠ¶æ€åˆ†å¸ƒ</div>
                <div class="chart-container" id="statusChart"></div>
            </div>
            <div class="chart-box">
                <div class="chart-title">æŠ½æ£€çŠ¶æ€åˆ†å¸ƒ</div>
                <div class="chart-container" id="sampleChart"></div>
            </div>
        </div>

        <!-- æ›´æ–°æ—¶é—´ -->
        <div class="update-time" id="updateTime"></div>
        </div>
    </div>

    <script>
        let currentTimeRange = '{{.TimeRange}}';
        let statusChart = null;
        let sampleChart = null;
        let updateInterval = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®å½“å‰æ—¶é—´æ®µæŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.time-btn').forEach(btn => {
                if (btn.dataset.range === currentTimeRange) {
                    btn.classList.add('active');
                }
            });

            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
            
            // åŠ è½½æ•°æ®ï¼ˆé¦–æ¬¡åŠ è½½ä¸æ˜¾ç¤ºåŠ è½½æç¤ºï¼‰
            loadDeviceStats(false);
            
            // è®¾ç½®è‡ªåŠ¨æ›´æ–°ï¼ˆæ¯30ç§’ï¼‰
            updateInterval = setInterval(function() {
                loadDeviceStats(true); // è‡ªåŠ¨æ›´æ–°æ—¶æ˜¾ç¤ºåŠ è½½æç¤º
            }, 30000);
        });

        // åˆ‡æ¢æ—¶é—´æ®µ
        function changeTimeRange(range) {
            console.log('åˆ‡æ¢æ—¶é—´èŒƒå›´:', range);
            currentTimeRange = range;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.range === range) {
                    btn.classList.add('active');
                }
            });

            // æ¸…é™¤è‡ªåŠ¨æ›´æ–°å®šæ—¶å™¨
            if (updateInterval) {
                clearInterval(updateInterval);
            }

            // é‡æ–°åŠ è½½æ•°æ®ï¼ˆæ‰‹åŠ¨åˆ‡æ¢æ—¶ä¸æ˜¾ç¤ºåŠ è½½æç¤ºï¼‰
            loadDeviceStats(false);
            
            // é‡æ–°è®¾ç½®è‡ªåŠ¨æ›´æ–°ï¼ˆæ¯30ç§’ï¼‰
            updateInterval = setInterval(function() {
                loadDeviceStats(true); // è‡ªåŠ¨æ›´æ–°æ—¶æ˜¾ç¤ºåŠ è½½æç¤º
            }, 30000);
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // å®¡æ ¸çŠ¶æ€é¥¼å›¾
            statusChart = echarts.init(document.getElementById('statusChart'));
            
            // æŠ½æ£€çŠ¶æ€é¥¼å›¾
            sampleChart = echarts.init(document.getElementById('sampleChart'));

            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´å›¾è¡¨
            window.addEventListener('resize', function() {
                statusChart.resize();
                sampleChart.resize();
            });
        }

        // åŠ è½½è®¾å¤‡ç»Ÿè®¡æ•°æ®
        function loadDeviceStats(showLoading = true) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            if (showLoading) {
                const updateTimeEl = document.getElementById('updateTime');
                if (updateTimeEl) {
                    updateTimeEl.innerHTML = '<span class="loading">â³</span>æ­£åœ¨æ›´æ–°æ•°æ®...';
                }
            }
            
            // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
            const timestamp = new Date().getTime();
            const url = `/overview/api/device?time_range=${currentTimeRange}&_t=${timestamp}`;
            
            // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log('åŠ è½½æ•°æ®ï¼Œæ—¶é—´èŒƒå›´:', currentTimeRange, 'URL:', url);
            
            fetch(url, {
                method: 'GET',
                cache: 'no-store', // ç¦ç”¨ç¼“å­˜
                headers: {
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('æ”¶åˆ°æ•°æ®:', data, 'æ—¶é—´èŒƒå›´:', currentTimeRange);
                    updateStatsCards(data);
                    updateCharts(data);
                    updateTime();
                })
                .catch(error => {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    const updateTimeEl = document.getElementById('updateTime');
                    if (updateTimeEl) {
                        const now = new Date();
                        const timeStr = now.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });
                        updateTimeEl.innerHTML = `âŒ æ•°æ®æ›´æ–°å¤±è´¥ (${timeStr})ï¼Œå°†åœ¨30ç§’åé‡è¯•`;
                    }
                });
        }

        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStatsCards(data) {
            animateValue('total', data.total);
            animateValue('pending', data.pending);
            animateValue('needFix', data.need_fix);
            animateValue('completed', data.completed);
            animateValue('pendingSample', data.pending_sample);
            animateValue('sampleNeedFix', data.sample_need_fix);
            animateValue('samplePassed', data.sample_passed);
            updateTaggedStats(data.tagged_stats || {});
        }

        // æ•°å­—åŠ¨ç”»
        function animateValue(id, target) {
            const element = document.getElementById(id);
            const current = parseInt(element.textContent) || 0;
            const duration = 1000;
            const startTime = Date.now();
            const startValue = current;

            function update() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(startValue + (target - startValue) * progress);
                element.textContent = currentValue.toLocaleString();

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    element.textContent = target.toLocaleString();
                }
            }

            update();
        }

        // æ›´æ–°tagç»Ÿè®¡æ˜¾ç¤º
        function updateTaggedStats(taggedStats) {
            const element = document.getElementById('taggedCount');
            if (!element) return;

            const tags = Object.keys(taggedStats);
            if (tags.length === 0) {
                element.textContent = 'æš‚æ— æ•°æ®';
                return;
            }

            // æ ¼å¼åŒ–æ˜¾ç¤ºï¼štagå€¼: æ•°é‡
            const statsText = tags.map(tag => `${tag}: ${taggedStats[tag]}`).join('  ');
            element.textContent = statsText;
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts(data) {
            // å®¡æ ¸çŠ¶æ€é¥¼å›¾
            const statusOption = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#00d4ff',
                    borderWidth: 1,
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    textStyle: {
                        color: '#b0bec5'
                    }
                },
                series: [
                    {
                        name: 'å®¡æ ¸çŠ¶æ€',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#0a0e27',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: '{b}\n{c} ({d}%)',
                            color: '#fff'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: 16,
                                fontWeight: 'bold'
                            },
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 212, 255, 0.5)'
                            }
                        },
                        data: [
                            { value: data.pending, name: 'æœªå®¡æ ¸', itemStyle: { color: '#ffa726' } },
                            { value: data.need_fix, name: 'å·²å®¡æ ¸å¾…æ•´æ”¹', itemStyle: { color: '#ef5350' } },
                            { value: data.completed, name: 'å·²å®Œæˆ', itemStyle: { color: '#66bb6a' } }
                        ]
                    }
                ]
            };
            statusChart.setOption(statusOption, true);

            // æŠ½æ£€çŠ¶æ€é¥¼å›¾
            const sampleOption = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#00d4ff',
                    borderWidth: 1,
                    textStyle: {
                        color: '#fff'
                    }
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    textStyle: {
                        color: '#b0bec5'
                    }
                },
                series: [
                    {
                        name: 'æŠ½æ£€çŠ¶æ€',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#0a0e27',
                            borderWidth: 2
                        },
                        label: {
                            show: true,
                            formatter: '{b}\n{c} ({d}%)',
                            color: '#fff'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: 16,
                                fontWeight: 'bold'
                            },
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 212, 255, 0.5)'
                            }
                        },
                        data: [
                            { value: data.pending_sample, name: 'å¾…æŠ½æ£€', itemStyle: { color: '#ffeb3b' } },
                            { value: data.sample_need_fix, name: 'æŠ½æ£€åå¾…æ•´æ”¹', itemStyle: { color: '#ff7043' } },
                            { value: data.sample_passed, name: 'æŠ½æ£€å·²é€šè¿‡', itemStyle: { color: '#26c6da' } }
                        ]
                    }
                ]
            };
            sampleChart.setOption(sampleOption, true);
        }

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const updateTimeEl = document.getElementById('updateTime');
            if (updateTimeEl) {
                updateTimeEl.innerHTML = `ğŸ”„ æ•°æ®å·²æ›´æ–° | æœ€åæ›´æ–°æ—¶é—´: <strong>${timeStr}</strong> | æ¯30ç§’è‡ªåŠ¨åˆ·æ–°`;
            }
        }

        // é¡µé¢å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>

