<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>{{.Title}} - 档案建档统计</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: "Microsoft YaHei", sans-serif; 
            display: flex; 
            height: 100vh; 
        }
        
        /* 左侧导航 */
        .sidebar { 
            width: 220px; 
            background-color: #2c3e50; 
            color: white; 
            display: flex; 
            flex-direction: column; 
        }
        .sidebar h3 { 
            text-align: center; 
            padding: 20px 0; 
            border-bottom: 1px solid #34495e; 
            margin: 0; 
        }
        .menu-item { 
            padding: 15px 20px; 
            color: #ecf0f1; 
            text-decoration: none; 
            display: block; 
            border-bottom: 1px solid #34495e; 
        }
        .menu-item:hover { 
            background-color: #34495e; 
        }
        .menu-item.active { 
            background-color: #3498db; 
        }
        
        /* 子菜单样式 */
        .submenu-item {
            padding: 12px 20px 12px 40px;
            color: #bdc3c7;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #34495e;
            font-size: 14px;
        }
        .submenu-item:hover {
            background-color: #34495e;
        }
        .submenu-item.active {
            background-color: #2980b9;
            color: white;
        }

        /* 右侧内容 */
        .content { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            background-color: #f5f6fa; 
        }
        
        /* 标题区 */
        .page-header {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .page-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 24px;
        }
        
        /* 表格容器 */
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* 表格 */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white;
        }
        th, td { 
            padding: 12px 15px; 
            text-align: center; 
            border: 1px solid #ddd;
            font-size: 14px; 
        }
        th { 
            background-color: #3498db; 
            font-weight: 600; 
            color: white;
        }
        tr:hover { 
            background-color: #f8f9fa; 
        }
        
        /* 汇总行样式 */
        .summary-row {
            background-color: #ecf0f1 !important;
            font-weight: bold;
            color: #2c3e50;
        }
        .summary-row:hover {
            background-color: #e0e5e8 !important;
        }
        
        /* 空数据提示 */
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }
        
        /* 数字高亮 */
        .count-cell {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .total-cell {
            font-weight: 600;
            color: #3498db;
        }
        
        /* 日期查询区域 */
        .date-filter {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .date-filter label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .date-filter input[type="date"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .date-filter button {
            padding: 8px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .date-filter button:hover {
            background-color: #2980b9;
        }
        
        .quick-select {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
        
        .quick-btn {
            padding: 6px 12px;
            background-color: #ecf0f1;
            color: #2c3e50;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .quick-btn:hover {
            background-color: #bdc3c7;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>档案建档统计</h3>
        <a href="/stats" class="menu-item {{if eq .ActiveMenu "stats"}}active{{end}}">统计信息</a>
        <a href="/device/filelist" class="menu-item {{if eq .ActiveMenu "filelist"}}active{{end}}">建档明细</a>
        <a href="/device/filelist" class="submenu-item {{if eq .SubMenu "device_filelist"}}active{{end}}">设备建档明细</a>
        <a href="/checkpoint/filelist" class="submenu-item {{if eq .SubMenu "checkpoint_filelist"}}active{{end}}">卡口建档明细</a>
        <a href="/audit" class="menu-item {{if eq .ActiveMenu "audit"}}active{{end}}">档案审核</a>
        <a href="/audit/progress" class="submenu-item {{if eq .SubMenu "audit_progress"}}active{{end}}">设备审核进度</a>
        <a href="/checkpoint/progress" class="submenu-item {{if eq .SubMenu "checkpoint_progress"}}active{{end}}">卡口审核进度</a>
        <a href="/audit/statistics" class="submenu-item {{if eq .SubMenu "audit_statistics"}}active{{end}}">月度建档数据</a>
        <a href="/users" class="menu-item {{if eq .ActiveMenu "settings"}}active{{end}}">系统设置</a>
        <a href="/users" class="submenu-item {{if eq .SubMenu "users"}}active{{end}}">用户信息</a>
        <a href="/taskconfig" class="submenu-item {{if eq .SubMenu "task_config"}}active{{end}}">任务配置</a>
        <a href="/logs" class="submenu-item {{if eq .SubMenu "logs"}}active{{end}}">操作日志</a>
    </div>

    <div class="content">
        
        <!-- 页面标题 -->
        <div class="page-header">
            <h2>{{.Title}}</h2>
        </div>

        <!-- 查询区域 -->
        <div class="date-filter">
            <form action="/stats" method="GET" style="display: flex; align-items: center; gap: 15px; flex: 1; flex-wrap: wrap;">
                <label>开始日期:</label>
                <input type="date" name="start_date" value="{{.StartDate}}">
                
                <label>结束日期:</label>
                <input type="date" name="end_date" value="{{.EndDate}}">
                
                <label>建档状态:</label>
                <select name="audit_status" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    <option value="">全部</option>
                    <option value="0" {{if eq .AuditStatus "0"}}selected{{end}}>未审核未建档</option>
                    <option value="1" {{if eq .AuditStatus "1"}}selected{{end}}>已审核未建档</option>
                    <option value="2" {{if eq .AuditStatus "2"}}selected{{end}}>已建档</option>
                </select>
                
                <button type="submit">查询</button>
                {{if or .StartDate .EndDate .AuditStatus}}
                <a href="/stats" style="padding: 8px 15px; background-color: #95a5a6; color: white; text-decoration: none; border-radius: 4px;">清除</a>
                {{end}}
            </form>
            
            <div style="display: flex; gap: 10px; align-items: center;">
                <div class="quick-select">
                    <button class="quick-btn" onclick="setToday()">今天</button>
                    <button class="quick-btn" onclick="setThisWeek()">本周</button>
                    <button class="quick-btn" onclick="setThisMonth()">本月</button>
                </div>
                <a href="/stats/export{{if .Query}}?{{.Query}}{{end}}" style="padding: 8px 20px; background-color: #27ae60; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">导出Excel</a>
            </div>
        </div>

        <!-- 统计表格 -->
        <div class="table-container">
            {{if .Stats}}
            <table>
                <thead>
                    <tr>
                        <th>分局</th>
                        <th>一类点</th>
                        <th>二类点</th>
                        <th>三类点</th>
                        <th>四类点</th>
                        <th>合计</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Stats}}
                    <tr>
                        <td>{{.ManagementUnit}}</td>
                        <td class="count-cell">{{.Type1Count}}</td>
                        <td class="count-cell">{{.Type2Count}}</td>
                        <td class="count-cell">{{.Type3Count}}</td>
                        <td class="count-cell">{{.Type4Count}}</td>
                        <td class="total-cell">{{.TotalCount}}</td>
                    </tr>
                    {{end}}
                    
                    <!-- 汇总行 -->
                    <tr class="summary-row">
                        <td>{{.Summary.ManagementUnit}}</td>
                        <td>{{.Summary.Type1Count}}</td>
                        <td>{{.Summary.Type2Count}}</td>
                        <td>{{.Summary.Type3Count}}</td>
                        <td>{{.Summary.Type4Count}}</td>
                        <td>{{.Summary.TotalCount}}</td>
                    </tr>
                </tbody>
            </table>
            {{else}}
            <div class="no-data">
                暂无统计数据
            </div>
            {{end}}
        </div>

    </div>

    <script>
        // 快捷日期选择功能
        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            const auditStatus = new URLSearchParams(window.location.search).get('audit_status') || '';
            let url = `/stats?start_date=${today}&end_date=${today}`;
            if (auditStatus) {
                url += `&audit_status=${auditStatus}`;
            }
            window.location.href = url;
        }
        
        function setThisWeek() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // 周一为起始
            
            const monday = new Date(now);
            monday.setDate(now.getDate() + diff);
            
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            const start = monday.toISOString().split('T')[0];
            const end = sunday.toISOString().split('T')[0];
            
            const auditStatus = new URLSearchParams(window.location.search).get('audit_status') || '';
            let url = `/stats?start_date=${start}&end_date=${end}`;
            if (auditStatus) {
                url += `&audit_status=${auditStatus}`;
            }
            window.location.href = url;
        }
        
        function setThisMonth() {
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            const start = firstDay.toISOString().split('T')[0];
            const end = lastDay.toISOString().split('T')[0];
            
            const auditStatus = new URLSearchParams(window.location.search).get('audit_status') || '';
            let url = `/stats?start_date=${start}&end_date=${end}`;
            if (auditStatus) {
                url += `&audit_status=${auditStatus}`;
            }
            window.location.href = url;
        }
    </script>

</body>
</html>