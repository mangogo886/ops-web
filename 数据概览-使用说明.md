# 数据概览功能使用说明

## 功能概述

数据概览大屏是一个实时数据展示页面，用于展示设备和卡口的统计数据，包括：
- 导入档案总数
- 未审核
- 已审核待整改
- 已完成
- 待抽检
- 抽检后待整改
- 抽检已通过

## 安装步骤

### 1. 下载 ECharts 文件

请按照 `static/echarts/README.md` 中的说明下载 ECharts 文件。

**快速下载（PowerShell）：**
```powershell
Invoke-WebRequest -Uri "https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js" -OutFile "static\echarts\echarts.min.js"
```

### 2. 编译运行

```bash
go build -o ops-web.exe main.go
./ops-web.exe
```

### 3. 访问页面

打开浏览器访问：`http://localhost:端口/overview`

## 功能特性

### 时间段筛选
- **近一周**：显示最近7天的数据
- **近一月**：显示最近30天的数据
- **全部**：显示所有时间段的数据

### 实时更新
- 页面每30秒自动刷新数据
- 显示最后更新时间

### 数据可视化
- **统计卡片**：7个关键指标卡片，带数字动画效果
- **审核状态饼图**：展示未审核、已审核待整改、已完成的比例
- **抽检状态饼图**：展示待抽检、抽检后待整改、抽检已通过的比例

### 大屏风格
- 深色主题背景
- 渐变色彩效果
- 发光边框和阴影
- 响应式设计，支持不同屏幕尺寸

## 技术实现

### 后端
- **路由**：`/overview` - 主页面
- **API**：`/overview/api/device` - 设备统计数据接口
- **Handler**：`internal/overview/handler.go`

### 前端
- **模板**：`templates/overview.html`
- **图表库**：ECharts 5.4.3
- **更新方式**：异步 AJAX 请求，每30秒自动更新

### 数据库查询
- 使用 LEFT JOIN 优化查询性能
- 支持时间段筛选
- 统计抽检状态需要关联 `audit_sample_records` 表

## 后续扩展

### 卡口统计
目前只实现了设备统计，卡口统计的接口已预留：
- `getCheckpointStats()` 函数已定义，待实现具体逻辑
- API 路由：`/overview/api/checkpoint`（已预留）

### 性能优化建议
1. 如果数据量很大，可以考虑添加缓存机制
2. 可以添加数据库索引优化查询：
   ```sql
   CREATE INDEX idx_audit_status_sampled_time 
   ON audit_tasks(audit_status, is_sampled, import_time);
   ```

## 注意事项

1. **ECharts 文件**：必须下载 ECharts 文件到 `static/echarts/` 目录，否则页面无法正常显示图表
2. **数据库表**：确保 `audit_tasks` 和 `audit_sample_records` 表已创建
3. **权限**：需要登录才能访问数据概览页面

## 问题排查

### 图表不显示
- 检查 ECharts 文件是否已下载到正确位置
- 检查浏览器控制台是否有 JavaScript 错误
- 检查静态文件服务是否正常（访问 `/static/echarts/echarts.min.js` 应该能下载文件）

### 数据不更新
- 检查 API 接口是否正常（访问 `/overview/api/device?time_range=week` 应该返回 JSON 数据）
- 检查数据库连接是否正常
- 查看服务器日志是否有错误信息

### 样式显示异常
- 检查浏览器是否支持 CSS3 特性（backdrop-filter 等）
- 尝试清除浏览器缓存


